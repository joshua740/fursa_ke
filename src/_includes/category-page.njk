{% extends "base.njk" %}

{% block content %}
<div class="hero">
    <div class="container">
        <h1>{{ title }}</h1>
        <p>{{ description }}</p>
        <div class="category-filters">
            <a href="/" class="filter-link">All</a>
            <a href="/jobs/" class="filter-link {% if category == 'job' %}active{% endif %}">Jobs</a>
            <a href="/internships/" class="filter-link {% if category == 'internship' %}active{% endif %}">Internships</a>
            <a href="/scholarships/" class="filter-link {% if category == 'scholarship' %}active{% endif %}">Scholarships</a>
        </div>
    </div>
</div>

<div class="container">
    <div class="content">
        <section class="category-listings">
            {% if collections[category].length > 0 %}
                {% for post in collections[category] | reverse %}
                <article class="opportunity">
                    <div class="opportunity-meta">
                        <span class="category">{{ post.data.category | title }}</span>
                        {% if post.data.isNew %}
                            <span class="badge new">NEW</span>
                        {% endif %}
                    </div>

                    <h2 class="opportunity-title">
                        <a href="{{ post.url }}">{{ post.data.title }}</a>
                    </h2>

                    <div class="opportunity-meta">
                        {% if post.data.company or post.data.organization %}
                        <span>{{ post.data.company or post.data.organization }}</span>
                        {% endif %}

                        {% if post.data.location %}
                        <span>{{ post.data.location }}</span>
                        {% endif %}

                        <time datetime="{{ post.date | formatDate('YYYY-MM-DD') }}">{{ post.date | formatDate }}</time>

                        {% if post.data.deadline %}
                        <span class="deadline">Deadline: {{ post.data.deadline | formatDate }}</span>
                        {% endif %}
                    </div>

                    {% if post.data.description %}
                    <div class="opportunity-description">
                        {{ post.data.description | truncate(300) }}
                    </div>
                    {% endif %}

                    <a href="{{ post.url }}" class="read-more">View Details</a>
                </article>
                {% endfor %}
            {% else %}
                <div class="no-opportunities">
                    <p>No {{ category }} available at the moment. Please check back later.</p>
                </div>
            {% endif %}

            {% if pagination.pages.length > 1 %}
            <nav class="pagination" aria-label="Pagination">
                {% if pagination.href.previous %}
                    <a href="{{ pagination.href.previous }}" class="pagination-link" rel="prev">← Previous</a>
                {% endif %}
                
                {% for pageEntry in pagination.pages %}
                    {% if page.url == pagination.hrefs[loop.index0] %}
                        <span class="pagination-current">{{ loop.index }}</span>
                    {% else %}
                        <a href="{{ pagination.hrefs[loop.index0] }}" class="pagination-link">{{ loop.index }}</a>
                    {% endif %}
                {% endfor %}
                
                {% if pagination.href.next %}
                    <a href="{{ pagination.href.next }}" class="pagination-link" rel="next">Next →</a>
                {% endif %}
            </nav>
            {% endif %}
        </section>
    </div>

    <aside class="sidebar">
        <div class="sidebar-widget popular-posts">
            <h2>Popular {{ category | title }}</h2>
            <ul>
            {% for post in collections.popular %}
                {% if post.data.category === category %}
                <li>
                    <a href="{{ post.url }}">
                        <h3>{{ post.data.title }}</h3>
                        <div class="post-meta">
                            <span class="category">{{ post.data.category | title }}</span>
                            <span class="views">{{ post.data.views }} views</span>
                        </div>
                    </a>
                </li>
                {% endif %}
            {% endfor %}
            </ul>
        </div>

        <div class="sidebar-widget whatsapp-cta">
            <h2>Join Our WhatsApp Community</h2>
            <p>Get Daily Updates on Latest Opportunities</p>
            <a href="https://wa.me/254714537786" class="whatsapp-button">
                Join WhatsApp Group
            </a>
        </div>
    </aside>
</div>
{% endblock %} 